# V0.5 Plan

This document defines the structured plan for V0.5.
It is a planning artifact only and does not imply implementation order beyond the stated tiers.

---

## Tier A — Low‑risk extension

### V0.5a Definition (Locked)

V0.5a is complete when:

- Documents text search is implemented over `title` and `notes` only.
- Search is case-insensitive and partial-match.
- Search matches if the query appears in either `title` OR `notes`.
- Default ordering is `createdAt` descending.
- `GET /documents?q=...` applies search.
- `GET /documents` without `q` returns the full household-scoped list.
- Household scoping remains server-derived and enforced.
- No category, tag, or date filters are included.
- Documentation reflects the behavior (§11).

### 1) Documents search (V0.5a: text only)

- **Intent**
  Enable basic retrieval by free‑text across metadata.
- **Scope**
  Only text search over `title` + `notes`.
  No category, tags, or date filters in V0.5a.
  `GET /documents` gains a `q` (or `query`) parameter; when absent, returns all.
- **Invariants impacted**
  §1–§3 (household‑scoped + server‑derived), §11 (docs update), §13 (ApplicationService boundary).
- **Files likely to change**
  `backend/src/main/java/app/lifelinq/features/documents/api/DocumentsController.java`
  `backend/src/main/java/app/lifelinq/features/documents/application/DocumentsApplicationService.java`
  `backend/src/main/java/app/lifelinq/features/documents/application/*`
  `backend/src/main/java/app/lifelinq/features/documents/domain/DocumentRepository.java`
  `backend/src/main/java/app/lifelinq/features/documents/infrastructure/*`
- **Tests required**
  Unit tests for search logic; adapter tests for query behavior; controller tests for scoping + query param.
- **Documentation impact**
  Update `docs/architecture/documents.md` to reflect text search only in V0.5a.

### 2) Todo calendar view (calendar‑oriented API)

- **Intent**
  Provide calendar‑centric access to scheduled todos.
- **Scope**
  New calendar‑oriented endpoint: month view only (not arbitrary date range).
  Endpoint: `GET /todos/calendar/{year}/{month}`.
  Returns items with `dueDate` within the target period.
- **Invariants impacted**
  §1–§3 (scoping), §5 (backend authority), §11, §13.
- **Files likely to change**
  `backend/src/main/java/app/lifelinq/features/todo/api/TodoController.java`
  `backend/src/main/java/app/lifelinq/features/todo/application/*`
  `backend/src/main/java/app/lifelinq/features/todo/domain/TodoRepository.java`
  `backend/src/main/java/app/lifelinq/features/todo/infrastructure/*`
- **Tests required**
  Unit tests for calendar query; adapter tests; controller tests for calendar endpoints.
- **Documentation impact**
  `docs/architecture/todo.md` and possibly `docs/00_overview.md` (calendar view no longer “planned”).

---

## Tier B — Domain‑deep change

### V0.5b Definition (Locked)

V0.5b is complete when:

- A calendar-oriented endpoint exists: `GET /todos/calendar/{year}/{month}`.
- Month uses ISO numbering `1` to `12`.
- Invalid month values return `400`.
- Month boundaries are computed using `YearMonth` in `UTC`.
- Filtering is based on `dueDate` (`LocalDate`) only.
- No timezone conversion is applied.
- Results include only todos with `dueDate` in the requested period.
- Ordering is stable and deterministic (by `dueDate`, then `id`).
- `GET /todos/calendar/...` returns an empty list when no items exist.
- Household scoping remains server-derived and enforced.
- Documentation reflects the behavior (§11).

### V0.5c Definition (Locked)

V0.5c is complete when:

- A minimal Recipe + Ingredient model exists in Meals with household scoping.
- Ingredients are persisted and retrievable for a recipe.
- In V0.5c, recipes serve primarily as a shopping-generator: ingredients listed on a recipe are used to push shopping items. Full culinary modeling (instructions, nutrition, comprehensive ingredient sets) is out of scope.
- Meals → Shopping creates items from ingredient names (and quantity/unit when present).
- Ingredient names are normalized before push.
- Duplicate ingredient names within a recipe create one shopping item per occurrence (no implicit merge in V0.5c).
- Meals interacts with Shopping only via `ShoppingApplicationService` (preserves §4).
- A recipe without ingredients results in no shopping items.
- Household scoping remains server-derived and enforced.
- Documentation reflects the behavior (§11).

### V0.5d Definition (Locked)

V0.5d is complete when:

- Tier A and Tier B features pass their dedicated tests.
- `mvn -q test` passes in `backend/`.
- Documentation across `docs/` shows no V0.5 drift (§11 sweep passes).

### V0.5d Final Lock

As of 2026-02-16, V0.5d is considered formally locked:

- `mvn -q test` passes in `backend/`.
- Documentation across `docs/` reflects current V0.5 behavior (§11).

### V0.5a Frontend Lock (Documents)

As of 2026-02-17, the V0.5a Documents frontend behavior is locked:

- Search calls `GET /documents?q=...` when query is non-empty.
- Query is trimmed before request; empty query calls `GET /documents`.
- Search and list render in the Documents screen.
- Create document flow is available in the Documents screen.
- Create action is guarded against empty title and disabled while loading.
- Remove document flow is available with confirmation in the Documents screen.
- Delete uses optimistic local removal on `204`; on `404`, the list is refreshed and a neutral sync message is shown.

### V0.5a+ Backend Extension (Documents Delete)

As of 2026-02-17, Documents delete is available in backend:

- `DELETE /documents/{id}` removes a document when it belongs to the current household.
- Returns `204` on successful delete.
- Returns `404` when the document id does not exist in the current household.

### V0.5b Frontend Integration (Todo Calendar)

As of 2026-02-17, Todo frontend is integrated with the backend month calendar endpoint:

- Scheduled view fetches from `GET /todos/calendar/{year}/{month}`.
- Scheduled view month can be changed in the UI (prev/next month controls).
- Status filtering remains applied client-side on the month result set.

### V0.5c Final Lock

As of 2026-02-16, V0.5c is considered formally locked:

- Locked behavior is covered by dedicated application/integration/controller tests.
- Full backend suite passes (`mvn -q test`).
- Documentation reflects the implemented V0.5c behavior (§11).

### V0.5c Frontend Integration (Meals)

As of 2026-02-17, Meals frontend is integrated with the V0.5c backend contract:

- Save meal creates or updates a household recipe via `POST/PUT /meals/recipes`.
- Save meal links the selected slot to that recipe via `POST /meals/weeks/{year}/{isoWeek}/days/{dayOfWeek}/meals/{mealType}`.
- Ingredients are sent as ordered entries (`position`), while `quantity` and `unit` remain unset in V0.5 UI.
- Shopping push is delegated to backend by sending `targetShoppingListId` (or `null` when disabled/unset).
- Frontend no longer pushes shopping items directly from the meals screen.

### V0.5 Frontend Extension (Shopping Lists)

As of 2026-02-17, Shopping Lists frontend supports list removal:

- Users can remove a shopping list from the shopping lists screen with confirmation.
- Removal calls `DELETE /shopping-lists/{listId}`.
- Users can open a list actions menu (`⋯`) with `Share`, `Edit name`, and `Delete`.
- Edit name calls `PATCH /shopping-lists/{listId}`.
- Users can reorder shopping lists with press-and-drag in the list view.
- Reorder calls `PATCH /shopping-lists/{listId}/order` with `direction` (`UP`/`DOWN`).

### 3) Meals ingredient model + ingredient‑driven shopping items

- **Intent**
  Replace placeholder shopping push with ingredient‑driven items.
- **Scope**
  Introduce Recipe + Ingredient model (minimal).
  Meals → Shopping push maps ingredients to shopping items.
  Must preserve §4 (feature isolation); Meals may only interact via `ShoppingApplicationService`.
- **Invariants impacted**
  §1–§4 (ownership + boundaries), §5, §11, §13.
- **Files likely to change**
  `backend/src/main/java/app/lifelinq/features/meals/domain/*`
  `backend/src/main/java/app/lifelinq/features/meals/application/*`
  `backend/src/main/java/app/lifelinq/features/meals/infrastructure/*`
  `backend/src/main/java/app/lifelinq/features/shopping/application/*` (only if needed for inputs)
- **Tests required**
  Ingredient mapping unit tests; Meals→Shopping integration tests; persistence adapter tests.
- **Documentation impact**
  `docs/architecture/meals.md`, `docs/architecture/data_model.md`, possibly `docs/00_overview.md`.
