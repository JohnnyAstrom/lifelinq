# V0.5 Plan

This document defines the structured plan for V0.5.
It is a planning artifact only and does not imply implementation order beyond the stated tiers.

---

## Tier A — Low‑risk extension

### V0.5a Definition (Locked)

V0.5a is complete when:

- Documents text search is implemented over `title` and `notes` only.
- Search is case-insensitive and partial-match.
- Search matches if the query appears in either `title` OR `notes`.
- Default ordering is `createdAt` descending.
- `GET /documents?q=...` applies search.
- `GET /documents` without `q` returns the full household-scoped list.
- Household scoping remains server-derived and enforced.
- No category, tag, or date filters are included.
- Documentation reflects the behavior (§11).

### 1) Documents search (V0.5a: text only)

- **Intent**
  Enable basic retrieval by free‑text across metadata.
- **Scope**
  Only text search over `title` + `notes`.
  No category, tags, or date filters in V0.5a.
  `GET /documents` gains a `q` (or `query`) parameter; when absent, returns all.
- **Invariants impacted**
  §1–§3 (household‑scoped + server‑derived), §11 (docs update), §13 (ApplicationService boundary).
- **Files likely to change**
  `backend/src/main/java/app/lifelinq/features/documents/api/DocumentsController.java`
  `backend/src/main/java/app/lifelinq/features/documents/application/DocumentsApplicationService.java`
  `backend/src/main/java/app/lifelinq/features/documents/application/*`
  `backend/src/main/java/app/lifelinq/features/documents/domain/DocumentRepository.java`
  `backend/src/main/java/app/lifelinq/features/documents/infrastructure/*`
- **Tests required**
  Unit tests for search logic; adapter tests for query behavior; controller tests for scoping + query param.
- **Documentation impact**
  Update `docs/architecture/documents.md` to reflect text search only in V0.5a.

### 2) Todo calendar view (calendar‑oriented API)

- **Intent**
  Provide calendar‑centric access to scheduled todos.
- **Scope**
  New calendar‑oriented endpoint: month or ISO‑week view (not arbitrary date range).
  Example: `GET /todos/calendar/{year}/{month}` or `GET /todos/calendar/{year}/weeks/{isoWeek}`.
  Returns items with `dueDate` within the target period.
- **Invariants impacted**
  §1–§3 (scoping), §5 (backend authority), §11, §13.
- **Files likely to change**
  `backend/src/main/java/app/lifelinq/features/todo/api/TodoController.java`
  `backend/src/main/java/app/lifelinq/features/todo/application/*`
  `backend/src/main/java/app/lifelinq/features/todo/domain/TodoRepository.java`
  `backend/src/main/java/app/lifelinq/features/todo/infrastructure/*`
- **Tests required**
  Unit tests for calendar query; adapter tests; controller tests for calendar endpoints.
- **Documentation impact**
  `docs/architecture/todo.md` and possibly `docs/00_overview.md` (calendar view no longer “planned”).

---

## Tier B — Domain‑deep change

### V0.5b Definition (Locked)

V0.5b is complete when:

- A calendar-oriented endpoint exists: `GET /todos/calendar/{year}/{month}`.
- Results include only todos with `dueDate` in the requested period.
- Ordering is stable and deterministic (by `dueDate`, then `id`).
- `GET /todos/calendar/...` returns an empty list when no items exist.
- Household scoping remains server-derived and enforced.
- Documentation reflects the behavior (§11).

### V0.5c Definition (Locked)

V0.5c is complete when:

- A minimal Recipe + Ingredient model exists in Meals with household scoping.
- Ingredients are persisted and retrievable for a recipe.
- Meals → Shopping creates items from ingredient names (and quantity/unit when present).
- Ingredient names are normalized before push.
- Duplicate ingredient names within a recipe create one shopping item per occurrence (no implicit merge in V0.5c).
- Meals interacts with Shopping only via `ShoppingApplicationService` (preserves §4).
- A recipe without ingredients results in no shopping items.
- Household scoping remains server-derived and enforced.
- Documentation reflects the behavior (§11).

### V0.5d Definition (Locked)

V0.5d is complete when:

- Tier A and Tier B features pass their dedicated tests.
- `mvn -q test` passes in `backend/`.
- Documentation across `docs/` shows no V0.5 drift (§11 sweep passes).

### 3) Meals ingredient model + ingredient‑driven shopping items

- **Intent**
  Replace placeholder shopping push with ingredient‑driven items.
- **Scope**
  Introduce Recipe + Ingredient model (minimal).
  Meals → Shopping push maps ingredients to shopping items.
  Must preserve §4 (feature isolation); Meals may only interact via `ShoppingApplicationService`.
- **Invariants impacted**
  §1–§4 (ownership + boundaries), §5, §11, §13.
- **Files likely to change**
  `backend/src/main/java/app/lifelinq/features/meals/domain/*`
  `backend/src/main/java/app/lifelinq/features/meals/application/*`
  `backend/src/main/java/app/lifelinq/features/meals/infrastructure/*`
  `backend/src/main/java/app/lifelinq/features/shopping/application/*` (only if needed for inputs)
- **Tests required**
  Ingredient mapping unit tests; Meals→Shopping integration tests; persistence adapter tests.
- **Documentation impact**
  `docs/architecture/meals.md`, `docs/architecture/data_model.md`, possibly `docs/00_overview.md`.
